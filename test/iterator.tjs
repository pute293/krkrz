(new TestIterator()).run();

class TestIterator extends Test {
  
  var name = 'ITERATOR';
  var tests = [
    'test_1',
    'test_2'
    //'test_forin_iterator',
    //'test_forin_array',
    //'test_forin_dict'
  ];
  
  class A {
    var i = 0;
    var array = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
    function next {
      return array[i++];
    }
    function hasNext {
      return i < array.count;
    }
  }
  
  function test_1 {
    var a = new A();
    var b = [];
    while (a.hasNext()) {
      b.add(a.next());
    }
    assert_equal_struct(b, a.array);
  }
  
  function test_2 {
    var a = %[
      i : 0,
      array : [10, 20, 30, 40, 50, 60, 70, 80, 90, 100],
      next : -> [ array[i++] ],
      hasNext : -> [ i < array.count ]
    ];
    var b = [];
    while (a.hasNext()) {
      b.add(a.next());
    }
    assert_equal_struct(b, a.array);
  }
  
  /*function test_forin_iterator {
    var a = new A();
    var b = [], c = [];
    var x = void;
    for (var x in a) {
      b.add(x);
    }
    assert_equal(x, void, 'x1');
    
    for (x in new A()) {
      c.add(x);
    }
    assert_equal(x, 100, 'x2');
    
    assert_equal_struct(b, a.array, '1');
    assert_equal_struct(c, a.array, '2');
  }
  
  function test_forin_array {
    var a = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
    var b = [], c = [], d = [];
    var x = void;
    for (var x in a) {
      b.add(x);
    }
    assert_equal(x, void, '1');
    assert_equal_struct(a, [10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '2');
    assert_equal_struct(b, a, '3');
    
    for (var x in [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]) {
      c.add(x);
    }
    assert_equal(x, void, '4');
    assert_equal_struct(c, a, '5');
    
    for (x in a) {
      d.add(x);
    }
    assert_equal(x, 100, '6');
    assert_equal_struct(a, [10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '7');
    assert_equal_struct(d, a, '8');
  }
  
  function test_forin_dict {
    var a = %[
      a : 10,
      b : 20,
      c : 30
    ];
    var b = %[], c = %[], d = %[];
    var x = void;
    for (var x in a) {
      b[x.key] = x.value;
    }
    assert_equal(x, void, '1');
    assert_equal_struct(a, [10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '2');
    assert_equal_struct(b, a, '3');
    
    for (var x in [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]) {
      c.add(x);
    }
    assert_equal(x, void, '4');
    assert_equal_struct(c, a, '5');
    
    for (x in a) {
      d.add(x);
    }
    assert_equal(x, 100, '6');
    assert_equal_struct(a, [10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '7');
    assert_equal_struct(d, a, '8');
  }*/
  
}

